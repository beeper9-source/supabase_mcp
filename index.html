<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개인문고관리</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-main">
                <h1><i class="fas fa-book"></i> 개인문고관리</h1>
                <div class="last-modified">
                    <i class="fas fa-clock"></i> 최종수정: <span id="lastModified"></span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showAddBookModal()">
                    <i class="fas fa-plus"></i> 새 도서 추가
                </button>
                <button class="btn btn-info" onclick="showLibraryModal()">
                    <i class="fas fa-building"></i> 도서관 관리
                </button>
                <button class="btn btn-warning" onclick="showClassificationModal()">
                    <i class="fas fa-tags"></i> 분류체계 관리
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    <i class="fas fa-download"></i> 데이터 내보내기
                </button>
            </div>
        </header>

        <!-- 도서관 선택 섹션 -->
        <div class="library-selector">
            <div class="library-info">
                <h2><i class="fas fa-building"></i> 현재 도서관</h2>
                <div class="current-library">
                    <span id="currentLibraryName">도서관을 선택하세요</span>
                    <button class="btn btn-sm btn-outline" onclick="showLibrarySelector()">
                        <i class="fas fa-exchange-alt"></i> 변경
                    </button>
                </div>
            </div>
        </div>

        <!-- 검색 및 필터 -->
        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="도서명, 저자, 분류체계로 검색..." onkeyup="searchBooks()">
            </div>
            <div class="filters">
                <select id="classificationFilter" onchange="filterBooks()">
                    <option value="">모든 분류체계</option>
                    <!-- 분류체계 옵션이 동적으로 로드됩니다 -->
                </select>
                <select id="sortBy" onchange="sortBooks()">
                    <option value="title">도서명순</option>
                    <option value="author">저자순</option>
                    <option value="published_date">출판일순</option>
                    <option value="price">가격순</option>
                </select>
            </div>
        </div>

        <!-- 통계 대시보드 -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <i class="fas fa-book"></i>
                <div class="stat-info">
                    <h3 id="totalBooks">0</h3>
                    <p>총 도서 수</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-layer-group"></i>
                <div class="stat-info">
                    <h3 id="totalClassifications">0</h3>
                    <p>분류체계 수</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-boxes"></i>
                <div class="stat-info">
                    <h3 id="totalStock">0</h3>
                    <p>총 보유권수</p>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-won-sign"></i>
                <div class="stat-info">
                    <h3 id="avgPrice">0</h3>
                    <p>평균 가격</p>
                </div>
            </div>
        </div>

        <!-- 도서 목록 -->
        <div class="books-section">
            <div class="section-header">
                <h2>도서 목록</h2>
                <div class="view-toggle">
                    <button class="btn btn-sm" onclick="toggleView('grid')" id="gridBtn">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="btn btn-sm" onclick="toggleView('list')" id="listBtn">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            <div class="books-grid" id="booksContainer">
                <!-- 도서 카드들이 여기에 동적으로 생성됩니다 -->
            </div>
        </div>
    </div>

    <!-- 도서 추가/수정 모달 -->
    <div id="bookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">새 도서 추가</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="bookForm" onsubmit="saveBook(event)">
                <div class="form-group">
                    <label for="bookIsbn">ISBN</label>
                    <input type="text" id="bookIsbn" placeholder="ISBN을 입력하세요">
                </div>
                <div class="form-group">
                    <label for="bookTitle">도서명 *</label>
                    <input type="text" id="bookTitle" required>
                </div>
                <div class="form-group">
                    <label for="bookAuthor">저자 *</label>
                    <input type="text" id="bookAuthor" required>
                </div>
                <div class="form-group">
                    <label for="bookPublishedDate">출판일</label>
                    <input type="date" id="bookPublishedDate">
                </div>
                <div class="form-group">
                    <label for="bookClassification">분류체계 *</label>
                    <select id="bookClassification" required>
                        <option value="">분류체계 선택</option>
                        <!-- 분류체계 옵션이 동적으로 로드됩니다 -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="bookPages">페이지 수</label>
                    <input type="number" id="bookPages" min="1">
                </div>
                <div class="form-group">
                    <label for="bookLanguage">언어</label>
                    <input type="text" id="bookLanguage" value="Korean">
                </div>
                <div class="form-group">
                    <label for="bookDescription">설명</label>
                    <textarea id="bookDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="bookPrice">가격 (원)</label>
                    <input type="number" id="bookPrice" min="0" step="100">
                </div>
                <div class="form-group">
                    <label for="bookStock">보유권수</label>
                    <input type="number" id="bookStock" min="1" value="1">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 도서 상세 모달 -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailTitle">도서 상세 정보</h2>
                <span class="close" onclick="closeDetailModal()">&times;</span>
            </div>
            <div id="detailContent">
                <!-- 도서 상세 정보가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 도서관 관리 모달 -->
    <div id="libraryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="libraryModalTitle">도서관 관리</h2>
                <span class="close" onclick="closeLibraryModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="library-tabs">
                    <button class="tab-btn active" onclick="showLibraryTab('list')" id="libraryListTabBtn">
                        <i class="fas fa-list"></i> 도서관 목록
                    </button>
                    <button class="tab-btn" onclick="showLibraryTab('add')" id="libraryAddTabBtn">
                        <i class="fas fa-plus"></i> 새 도서관 추가
                    </button>
                </div>
                
                <!-- 도서관 목록 탭 -->
                <div id="libraryListTab" class="tab-content active">
                    <div id="librariesList">
                        <!-- 도서관 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
                
                <!-- 새 도서관 추가 탭 -->
                <div id="libraryAddTab" class="tab-content">
                    <form id="libraryForm" onsubmit="saveLibrary(event)">
                        <div class="form-group">
                            <label for="libraryName">도서관명 *</label>
                            <input type="text" id="libraryName" required>
                        </div>
                        <div class="form-group">
                            <label for="libraryDescription">설명</label>
                            <textarea id="libraryDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="libraryAddress">주소</label>
                            <input type="text" id="libraryAddress">
                        </div>
                        <div class="form-group">
                            <label for="libraryPhone">전화번호</label>
                            <input type="tel" id="libraryPhone">
                        </div>
                        <div class="form-group">
                            <label for="libraryEmail">이메일</label>
                            <input type="email" id="libraryEmail">
                        </div>
                        <div class="form-group">
                            <label for="libraryWebsite">웹사이트</label>
                            <input type="url" id="libraryWebsite">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeLibraryModal()">취소</button>
                            <button type="submit" class="btn btn-primary">저장</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 도서관 선택 모달 -->
    <div id="librarySelectorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>도서관 선택</h2>
                <span class="close" onclick="closeLibrarySelector()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="librarySelectorList">
                    <!-- 도서관 선택 목록이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 분류체계 관리 모달 -->
    <div id="classificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="classificationModalTitle">분류체계 관리</h2>
                <span class="close" onclick="closeClassificationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="classification-tabs">
                    <button class="tab-btn active" onclick="showClassificationTab('list')" id="classificationListTabBtn">
                        <i class="fas fa-list"></i> 분류체계 목록
                    </button>
                    <button class="tab-btn" onclick="showClassificationTab('add')" id="classificationAddTabBtn">
                        <i class="fas fa-plus"></i> 새 분류 추가
                    </button>
                </div>
                
                <!-- 분류체계 목록 탭 -->
                <div id="classificationListTab" class="tab-content active">
                    <div id="classificationsList">
                        <!-- 분류체계 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
                
                <!-- 새 분류 추가 탭 -->
                <div id="classificationAddTab" class="tab-content">
                    <form id="classificationForm" onsubmit="saveClassification(event)">
                        <div class="form-group">
                            <label for="classificationName">분류명 *</label>
                            <input type="text" id="classificationName" required>
                        </div>
                        <div class="form-group">
                            <label for="classificationDescription">설명</label>
                            <textarea id="classificationDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="classificationSubcategories">하위 분류 (쉼표로 구분)</label>
                            <input type="text" id="classificationSubcategories" placeholder="예: 한국문학, 세계문학, 장편소설">
                        </div>
                        <div class="form-group">
                            <label for="classificationExamples">예시 도서</label>
                            <textarea id="classificationExamples" rows="2" placeholder="예: 김승옥, 도스토예프스키, 카프카 등"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="classificationOrder">표시 순서</label>
                            <input type="number" id="classificationOrder" min="1" max="100" value="1">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeClassificationModal()">취소</button>
                            <button type="submit" class="btn btn-primary">저장</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 로딩 스피너 -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner"></div>
        <p>데이터를 불러오는 중...</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</body>
</html>
